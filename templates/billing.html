{% extends "base_portal.html" %}

{% block title %}Manage Billing{% endblock %}

{% block portal_content %}
<div class="portal-header billing-header">
    <div class="current-plan-info">
        <h1>Manage your plan</h1>
        <p>Your current plan: <strong>{{ current_user.current_plan.replace('_', ' ')|title }}</strong></p>
        <p>You have <strong>{{ current_user.token_balance }}</strong> credits.</p>
        <form action="{{ url_for('create_portal_session') }}" method="POST" style="margin-top: 20px;">
            <button class="btn btn-secondary" type="submit">Manage Subscription in Stripe</button>
        </form>
    </div>
    <div class="plan-card">
        <h3 class="plan-name">Top Up Credits</h3>
        <p class="plan-description">Need more credits before your next renewal?</p>
        <div class="plan-price">&euro;5</div>
        <ul class="plan-includes">
            <li class="available"><svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" /></svg>One-time purchase of 1,000 credits</li>
        </ul>
        <form action="{{ url_for('create_checkout_session') }}" method="POST">
            <input type="hidden" name="price_id" value="{{ TOKEN_PRICE_ID }}" />
            <button type="submit" class="btn">Purchase Credits</button>
        </form>
    </div>
</div>

<div class="plans-grid">
    <div class="plan-card {% if current_user.current_plan == 'taste' %}highlighted{% endif %}">
        <h3 class="plan-name">A Taste Of It</h3>
        <div class="plan-price" style="margin-bottom: 25px;">&euro;9<span>/mo</span></div>
        <ul class="plan-includes">
             <li class="available"><svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" /></svg>1,500 credits</li>
            <li class="unavailable"><svg fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" /></svg>Credit Top-Up</li>
        </ul>
        {% if current_user.current_plan == 'taste' %}
            <button class="btn-disabled">Your Current Plan</button>
        {% else %}
            <button class="btn btn-secondary" onclick="document.querySelector('#portal-form').submit();">Change Plan</button>
        {% endif %}
    </div>

    <div class="plan-card {% if current_user.current_plan == 'best' %}highlighted{% endif %}">
        <h3 class="plan-name">The Best Pick</h3>
        <div class="plan-price" style="margin-bottom: 25px;">&euro;19<span>/mo</span></div>
         <ul class="plan-includes">
            <li class="available"><svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" /></svg>4,500 credits</li>
            <li class="available"><svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" /></svg>Credit Top-Up</li>
        </ul>
        {% if current_user.current_plan == 'best' %}
            <button class="btn-disabled">Your Current Plan</button>
        {% else %}
             <button class="btn" onclick="document.querySelector('#portal-form').submit();">Change Plan</button>
        {% endif %}
    </div>

    <div class="plan-card {% if current_user.current_plan == 'pro' %}highlighted{% endif %}">
        <h3 class="plan-name">Pick&Flip PRO</h3>
        <div class="plan-price" style="margin-bottom: 25px;">&euro;35<span>/mo</span></div>
        <ul class="plan-includes">
            <li class="available"><svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" /></svg>15,000 credits</li>
            <li class="available"><svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" /></svg>Early Access to New Features</li>
        </ul>
        {% if current_user.current_plan == 'pro' %}
            <button class="btn-disabled">Your Current Plan</button>
        {% else %}
            <button class="btn" onclick="document.querySelector('#portal-form').submit();">Change Plan</button>
        {% endif %}
    </div>
</div>
<form id="portal-form" action="{{ url_for('create_portal_session') }}" method="POST" style="display: none;"></form>
{% endblock %}
