{% extends "base_app.html" %}

{% block title %}Управление планом{% endblock %}

{% block content %}
<style>
    /* Дополнительный стиль для информационного блока */
    .notice-bar {
        text-align: center;
        padding: 15px;
        background-color: rgba(255, 222, 0, 0.2);
        border: 1px solid rgba(255, 222, 0, 0.4);
        border-radius: var(--button-border-radius);
        margin: 0 auto 40px auto;
        max-width: 1100px;
        color: var(--primary-text-color);
        font-weight: 500;
    }
</style>

<div class="app-container" style="display: block; padding-bottom: 40px;">

    <div class="notice-bar">
        Раздел управления подписками и платежами находится в разработке.
    </div>

    <div class="billing-header" style="max-width: 1100px; margin: 0 auto 40px auto;">
        <div class="current-plan-info">
            <h1>Управление планом</h1>
            
            <p>Ваш текущий план: 
                <strong>
                {% set plan_display_name = {
                    'taste': 'A Taste Of It',
                    'best': 'The Best Pick',
                    'pro': 'Pifly PRO'
                } %}
                {% set display_name = plan_display_name.get(current_user.current_plan, 'Free') %}
                {{ display_name }}
                </strong>
            </p>

            <p>У вас <strong>{{ current_user.token_balance }}</strong> кредитов.</p>
        </div>
        <div class="plan-card">
            <h3 class="plan-name">Пополнить кредиты</h3>
            <p class="plan-description">Нужно больше кредитов до следующего обновления?</p>
            <div class="plan-price">&euro;5</div>
            <ul class="plan-includes">
                <li class="available"><svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" /></svg>Разовая покупка 1,000 кредитов</li>
            </ul>
            <button class="btn btn-disabled" disabled>Функция в разработке</button>
        </div>
    </div>

    <hr style="width: 100%; max-width: 1100px; border-color: var(--border-color); margin: 40px auto;">

    <div class="plans-grid" style="max-width: 1100px; margin: 40px auto 0 auto;">
        
        <div class="plan-card">
            <h3 class="plan-name">A Taste Of It</h3>
            <p class="plan-description">Для тех, кто хочет начать</p>
            <div class="plan-price">&euro;9<span>/мес</span></div>
            <ul class="plan-includes">
                <li class="available"><svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" /></svg>1,500 кредитов</li>
                <li class="available"><svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" /></svg>До 90 изображений в месяц</li>
                <li class="unavailable"><svg fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" /></svg>Покупка доп. кредитов</li>
                </ul>
            <form action="{{ url_for('create_payment') }}" method="POST">
                <input type="hidden" name="plan" value="taste">
                <button type="submit" class="btn">Выбрать план</button>
            </form>
        </div>

        <div class="plan-card highlighted">
            <h3 class="plan-name">The Best Pick</h3>
            <p class="plan-description">Лучший выбор для постоянных авторов</p>
            <div class="plan-price">&euro;19<span>/мес</span></div>
            <ul class="plan-includes">
                <li class="available"><svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" /></svg>4,500 кредитов</li>
                 <li class="available"><svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" /></svg>До 270 изображений в месяц</li>
                <li class="available"><svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" /></svg>Покупка доп. кредитов</li>
                </ul>
            <form action="{{ url_for('create_payment') }}" method="POST">
                <input type="hidden" name="plan" value="best">
                <button type="submit" class="btn">Выбрать план</button>
            </form>

        <div class="plan-card">
            <h3 class="plan-name">Pifly PRO</h3>
            <p class="plan-description">Для команд и продвинутых пользователей</p>
            <div class="plan-price">&euro;35<span>/мес</span></div>
            <ul class="plan-includes">
                <li class="available"><svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" /></svg>15,000 кредитов</li>
                <li class="available"><svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" /></svg>До 900 изображений в месяц</li>
                <li class="available"><svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" /></svg>Покупка доп. кредитов</li>
                </ul>
            <form action="{{ url_for('create_payment') }}" method="POST">
                <input type="hidden" name="plan" value="pro">
                <button type="submit" class="btn">Выбрать план</button>
            </form>
        </div>
    </div>

    {% if current_user.is_authenticated %}
    <div style="max-width: 1100px; margin: 60px auto 0 auto; text-align: center; border-top: 1px solid var(--border-color); padding-top: 40px;">
        <div style="display: flex; justify-content: center; gap: 20px; flex-wrap: wrap;">
            <form action="{{ url_for('delete_account') }}" method="POST">
                <button type="submit" class="btn btn-danger" onclick="return confirm('ВНИМАНИЕ: Это действие немедленно и навсегда удалит ваш аккаунт и все данные. Отменить это будет невозможно. Вы уверены?')">Удалить аккаунт</button>
            </form>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
